name: "üö® Verificar se PR referencia uma issue"

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

permissions:
  contents: read
  pull-requests: write   # precisa de write pra comentar

jobs:
  check-pr:
    runs-on: ubuntu-latest
    steps:
      - name: ‚úÖ Verificando se PR referencia uma issue
        id: check_title
        uses: Slashgear/action-check-pr-title@v4.3.0
        with:
          regexp: '.*(close[sd]?|resolve[sd]?|fix(e[sd])?)\s+#\d+.*'
          helpMessage: "O t√≠tulo do PR n√£o referencia uma issue. √â recomendado colocar algo como 'fixes #123' ou 'closes #456'."
          failOnError: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: üí¨ Comentar no PR se n√£o houver refer√™ncia a issue
        if: steps.check_title.outcome == 'failure'
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ‚ö†Ô∏è Ol√°! Parece que o t√≠tulo do PR n√£o referencia nenhuma issue.
            √â recomend√°vel colocar algo como `fixes #123` ou `closes #456`.
            Isso ajuda a manter o hist√≥rico e fechar issues automaticamente.